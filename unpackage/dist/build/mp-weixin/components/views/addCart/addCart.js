(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/views/addCart/addCart"],{"25d6":function(t,e,i){"use strict";(function(t){function i(t){return s(t)||o(t)||r(t)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t,e){if(t){if("string"===typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?u(t,e):void 0}}function o(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function s(t){if(Array.isArray(t))return u(t)}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={name:"addCart",props:{scrollTop:{type:String,default:"0"}},data:function(){return{popupShow:!1,buyNum:1,skuList:[],skuArray:[],propsList:[],invalidSkuList:[],invalidSkuIndexList:[],selectedIndex:[],selectedGoodsAttrList:[],goodsDetail:{selectedGoodsPropList:[]}}},filters:{attrFormat:function(t){var e="";return t.forEach((function(t){e+=t.value+"，"})),e.slice(0,-1)}},computed:{goodsList:function(){return this.$store.state.goodsList}},methods:{initial:function(e,i){var n=this;if(this.skuList=this.goodsList.filter((function(t){return t.spu_id===e})),0===this.skuList.length&&t.redirectTo({url:"/pages/index/invalidProduct/invalidProduct"}),i){var r=this.skuList.findIndex((function(t){return t.id===i}));-1===r?t.redirectTo({url:"/pages/index/invalidProduct/invalidProduct"}):this.goodsDetail=this.skuList[r]}else this.goodsDetail=this.skuList[0];var o={};this.goodsDetail.selectedGoodsAttrList.forEach((function(t){o[t.name]||(o[t.name]=t.value)})),this.selectedGoodsAttrList=Object.keys(o).map((function(t){return{name:t,value:o[t]}})),this.$nextTick((function(){var t={};n.skuList.forEach((function(e){e.selectedGoodsAttrList.forEach((function(e){t[e.name]?t[e.name].add(e.value):t[e.name]=new Set([e.value])}))})),n.propsList=Object.keys(t).map((function(e){return{name:e,values:Array.from(t[e])}}));var e=[];n.propsList.forEach((function(t){var i=t.values.map((function(e){return{name:t.name,value:e}}));e.push(i)})),n.skuArray=e,n.invalidSkuList=n.verify();var i=[];n.invalidSkuList.forEach((function(e){var n=[];e.forEach((function(e){var i=JSON.parse(e);n.push(Array.from(t[i.name]).indexOf(i.value))})),i.push(JSON.stringify(n))})),n.invalidSkuIndexList=i;var r=Object.keys(t);n.selectedIndex=new Array(n.propsList.length).fill(0),n.selectedGoodsAttrList.forEach((function(t){var e=r.indexOf(t.name);n.selectedIndex[e]=n.propsList[e].values.indexOf(t.value)})),n.$emit("select",n.goodsDetail,n.selectedGoodsAttrList)}))},onSelect:function(t,e){var i=this;if(this.isInvalid(t,e))this.tui.toast("该规格已售罄");else{this.selectedIndex[t]=e;var n=new Array,r=[];this.propsList.forEach((function(t,e){var o={name:t.name,value:t.values[i.selectedIndex[e]]};r.push(o),n.push(JSON.stringify(o))})),this.selectedGoodsAttrList=r;var o=this.skuList.findIndex((function(t){var e=t.selectedGoodsAttrList.filter((function(t){return n.includes(JSON.stringify(t))}));return e.length===n.length}));this.goodsDetail=this.skuList[o],this.$emit("select",this.goodsDetail,this.selectedGoodsAttrList)}},isInvalid:function(t,e){var i=JSON.parse(JSON.stringify(this.selectedIndex));return i[t]=e,this.invalidSkuIndexList.includes(JSON.stringify(i))},calcDescartes:function(t){return t.length<2?t[0].map((function(t){return new Array(t)}))||[]:t.reduce((function(t,e){var n=[];return t.forEach((function(t){e.forEach((function(e){t instanceof Array?n.push([].concat(i(t),[e])):n.push([t,e])}))})),n}))},verify:function(){var t=this,e=[],i=this.calcDescartes(this.skuArray);return i.forEach((function(i){var n=[];i.forEach((function(t){n.push(JSON.stringify(t))}));var r=t.skuList.findIndex((function(t){var e=t.selectedGoodsAttrList.filter((function(t){return n.includes(JSON.stringify(t))}));return e.length===n.length}));-1===r&&e.push(n)})),e},hidePopup:function(){this.popupShow=!1},change:function(t){this.buyNum=t.value},addCart:function(){var e=this,i={id:this.goodsDetail.id,spu_id:this.goodsDetail.spu_id,price:this.goodsDetail.price,integerPrice:this.goodsDetail.integerPrice,decimalPrice:this.goodsDetail.decimalPrice,title:this.goodsDetail.title,slogan:this.goodsDetail.slogan,defaultImageUrl:this.goodsDetail.defaultImageUrl,propertyList:this.selectedGoodsAttrList,buyNum:this.buyNum};if(this.tui.isLogin()){var n="/updateCustomer/"+t.getStorageSync("pid")+"/addCart";this.tui.request(n,"PUT",{newGoods:i}).then((function(t){"0"===t.code&&(e.$emit("add",i),e.tui.toast("成功添加到购物车"))}))}else t.navigateTo({url:"/pages/my/login/login"});this.popupShow=!1},submit:function(){this.popupShow=!1;var t=[{id:this.goodsDetail.id,spu_id:this.goodsDetail.spu_id,price:this.goodsDetail.price,integerPrice:this.goodsDetail.integerPrice,decimalPrice:this.goodsDetail.decimalPrice,title:this.goodsDetail.title,slogan:this.goodsDetail.slogan,defaultImageUrl:this.goodsDetail.defaultImageUrl,propertyList:this.selectedGoodsAttrList,buyNum:this.buyNum}],e="/pages/order/submitOrder/submitOrder?goods="+JSON.stringify(t);this.tui.href(e,!0)}}};e.default=a}).call(this,i("543d")["default"])},"46b2":function(t,e,i){"use strict";i.r(e);var n=i("53b5"),r=i("ddf5");for(var o in r)"default"!==o&&function(t){i.d(e,t,(function(){return r[t]}))}(o);i("f857");var s,u=i("f0c5"),a=Object(u["a"])(r["default"],n["b"],n["c"],!1,null,"53ebf16f",null,!1,n["a"],s);e["default"]=a.exports},"53b5":function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return n}));var n={tuiBottomPopup:function(){return i.e("components/thorui/tui-bottom-popup/tui-bottom-popup").then(i.bind(null,"dd5b"))},tuiNumberbox:function(){return i.e("components/thorui/tui-numberbox/tui-numberbox").then(i.bind(null,"31bb"))},tuiButton:function(){return i.e("components/thorui/tui-button/tui-button").then(i.bind(null,"009d"))},tuiIcon:function(){return Promise.all([i.e("common/vendor"),i.e("components/thorui/tui-icon/tui-icon")]).then(i.bind(null,"acf0"))}},r=function(){var t=this,e=t.$createElement,i=(t._self._c,t._f("attrFormat")(t.selectedGoodsAttrList)),n=t.__map(t.propsList,(function(e,i){var n=t.__get_orig(e),r=t.__map(e.values,(function(e,n){var r=t.__get_orig(e),o=t.isInvalid(i,n);return{$orig:r,m0:o}}));return{$orig:n,l0:r}}));t.$mp.data=Object.assign({},{$root:{f0:i,l1:n}})},o=[]},d625:function(t,e,i){},ddf5:function(t,e,i){"use strict";i.r(e);var n=i("25d6"),r=i.n(n);for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=r.a},f857:function(t,e,i){"use strict";var n=i("d625"),r=i.n(n);r.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/views/addCart/addCart-create-component',
    {
        'components/views/addCart/addCart-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("46b2"))
        })
    },
    [['components/views/addCart/addCart-create-component']]
]);
