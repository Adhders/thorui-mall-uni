(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/refund/refund"],{"0949":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r("fa5f"));function i(e){return e&&e.__esModule?e:{default:e}}var u=function(){r.e("components/views/t-order-item/t-order-item").then(function(){return resolve(r("3b84"))}.bind(null,r)).catch(r.oe)},o={components:{tOrderItem:u},data:function(){return{edit:!1,repeat:!1,focus:!1,first:!0,range:!0,order:{},width:"",choice:"refundType",formData:{},bucket_image:"chuangbiying-review",action:"https://up-cn-east-2.qiniup.com",ruleForm:{imgs:"",refund_fee:"",detail:"",refundType:"退货退款",reason:""},popupShow:!1,displayList:[],typeList:[{name:"换货",checked:!1},{name:"退货退款",checked:!1}],reasonList:[{name:"多拍、错拍、不喜欢",checked:!1},{name:"不喜欢、效果不好",checked:!1},{name:"材质与商品描述不符",checked:!1},{name:"大小尺寸与商品不符",checked:!1},{name:"颜色、款式、型号与描述不符",checked:!1},{name:"质量问题",checked:!1},{name:"做工粗糙、有瑕疵",checked:!1},{name:"收到商品少件、破损或污渍",checked:!1},{name:"商家发错货",checked:!1},{name:"假冒品牌",checked:!1},{name:"其它",checked:!1}],goodsList:[]}},onLoad:function(t){var r=this;this.repeat=t.repeat,this.edit=t.edit,this.order=JSON.parse(decodeURIComponent(t.order)),this.edit?(this.ruleForm.imgs=this.order.imgs,this.ruleForm.detail=this.order.detail,this.ruleForm.refundType=this.order.refundType,this.ruleForm.refund_fee=this.order.refund_fee,this.ruleForm.reason=this.order.reason):(this.ruleForm.refund_fee=this.order.netCost,this.ruleForm.refundType=t.refundType);var n=getApp().globalData.windowWidth/(e.upx2px(100)/100);this.width=(n-100)/3;var i="/upload/token/"+this.bucket_image;this.tui.request(i).then((function(e){r.uptoken=e.token,r.formData={token:r.uptoken}})).catch((function(e){console.log(e.response)}))},computed:{count:function(){return 150-this.getCount(this.ruleForm.detail.length)},refundList:function(){return this.$store.state.refundList},orderList:function(){return this.$store.state.orderList}},watch:{"ruleForm.refund_fee":function(e){e>this.order.netCost?(this.range=!1,this.tui.toast("退款金额不能大于最大退款金额")):this.range=!0}},filters:{getProperty:function(e){var t="";return e.forEach((function(e){t=t+e.value+"，"})),t.slice(0,-1)}},methods:{hidePopup:function(){this.popupShow=!1},detail:function(t){this.$store.commit("setTargetOrder",t),e.navigateTo({url:"/pages/my/orderDetail/orderDetail"})},getCount:function(e){var t=Number(this.maxlength);return e>t?t:e},onPopup:function(e){this.popupShow=!0,this.choice=e,this.displayList="refundType"===e?this.typeList:this.reasonList},radioChange:function(e){"refundType"===this.choice?this.ruleForm.refundType=this.typeList[e.detail.value].name:this.ruleForm.reason=this.reasonList[e.detail.value].name,this.hidePopup()},onSuccess:function(e){1===e.status&&(this.ruleForm.imgs=e.keyList)},formSubmit:function(t){var r=this,i=[{name:"refundType",rule:["required"],msg:["请选择售后类型"]},{name:"reason",rule:["required"],msg:["请选择退款原因"]},{name:"detail",rule:["required"],msg:["请填写申请说明"]}],u={name:"refund_fee",rule:["required"],msg:["请输入退款金额"]};"退货退款"===this.ruleForm.refundType&&i.splice(2,0,u);var o=this.ruleForm,d=this.range?n.default.validation(o,i):"退款金额不能大于最大退款金额";if(d)e.showToast({title:d,icon:"none"});else{this.first=!1;var s=e.getStorageSync("pid"),a=this.$store.state.appid,c=this.order.orderNum;if(this.edit){var f="/updateRefundOrders/"+this.order.refundNum+"/edit";this.tui.request(f,"PUT",this.ruleForm).then((function(t){var n=Object.assign({},r.order,r.ruleForm),i=r.orderList.findIndex((function(e){return e.orderNum===r.order.orderNum}));if(-1!==i){var u=r.orderList[i].refundList,o=u.findIndex((function(e){return e.refundNum===r.order.refundNum}));r.$set(u,o,n)}var d=r.refundList.findIndex((function(e){return e.refundNum===n.refundNum}));r.$set(r.refundList,d,n),r.tui.toast("更新成功"),setTimeout((function(){e.navigateBack({delta:1})}),500)}))}else{var l="/addRefundOrder/"+s+"/"+a+"/"+c;this.tui.request(l,"POST",this.ruleForm).then((function(t){if("0"===t.code){var n=r.orderList.findIndex((function(e){return e.orderNum===r.order.orderNum}));if(-1!==n&&(r.orderList[n].status=t.refundOrder.status,r.orderList[n].refundList.unshift(t.refundOrder)),r.repeat){var i=r.refundList.findIndex((function(e){return e.refundNum===r.order.refundNum}));-1!==i&&r.refundList[i].refundList.unshift(t.refundOrder)}r.$store.state.orderState[5]+=1,r.order.refundList.unshift(t.refundOrder),r.refundList.unshift(Object.assign({},r.order,t.refundOrder));var u="refundDetail"===r.repeat?3:2;e.navigateBack({delta:u}),r.tui.toast("申请售后成功")}}))}}}}};t.default=o}).call(this,r("543d")["default"])},2452:function(e,t,r){"use strict";r.r(t);var n=r("a66d"),i=r("ed22");for(var u in i)"default"!==u&&function(e){r.d(t,e,(function(){return i[e]}))}(u);r("b226");var o,d=r("f0c5"),s=Object(d["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);t["default"]=s.exports},a66d:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return n}));var n={tuiListCell:function(){return r.e("components/thorui/tui-list-cell/tui-list-cell").then(r.bind(null,"057e"))},tuiTextarea:function(){return r.e("components/thorui/tui-textarea/tui-textarea").then(r.bind(null,"db8e"))},tuiUpload:function(){return r.e("components/thorui/tui-upload/tui-upload").then(r.bind(null,"b008"))},tuiButton:function(){return r.e("components/thorui/tui-button/tui-button").then(r.bind(null,"009d"))},tuiBottomPopup:function(){return r.e("components/thorui/tui-bottom-popup/tui-bottom-popup").then(r.bind(null,"dd5b"))},tuiIcon:function(){return Promise.all([r.e("common/vendor"),r.e("components/thorui/tui-icon/tui-icon")]).then(r.bind(null,"acf0"))},tuiRadioGroup:function(){return r.e("components/thorui/tui-radio-group/tui-radio-group").then(r.bind(null,"6933"))},tuiLabel:function(){return r.e("components/thorui/tui-label/tui-label").then(r.bind(null,"c8b0"))},tuiRadio:function(){return r.e("components/thorui/tui-radio/tui-radio").then(r.bind(null,"524a"))}},i=function(){var e=this,t=e.$createElement,r=(e._self._c,e.__map(e.displayList,(function(t,r){var n=e.__get_orig(t),i=r.toString();return{$orig:n,g0:i}})));e.$mp.data=Object.assign({},{$root:{l0:r}})},u=[]},adce:function(e,t,r){"use strict";(function(e){r("c514");n(r("66fd"));var t=n(r("2452"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r("543d")["createPage"])},b226:function(e,t,r){"use strict";var n=r("df04"),i=r.n(n);i.a},df04:function(e,t,r){},ed22:function(e,t,r){"use strict";r.r(t);var n=r("0949"),i=r.n(n);for(var u in n)"default"!==u&&function(e){r.d(t,e,(function(){return n[e]}))}(u);t["default"]=i.a}},[["adce","common/runtime","common/vendor"]]]);