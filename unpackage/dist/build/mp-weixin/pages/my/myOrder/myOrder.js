(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/myOrder/myOrder"],{"256d":function(t,e,n){"use strict";var i=n("2d82"),r=n.n(i);r.a},"2d82":function(t,e,n){},9299:function(t,e,n){"use strict";n.r(e);var i=n("d6d2"),r=n("c14f");for(var o in r)"default"!==o&&function(t){n.d(e,t,(function(){return r[t]}))}(o);n("256d");var u,s=n("f0c5"),a=Object(s["a"])(r["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],u);e["default"]=a.exports},c14f:function(t,e,n){"use strict";n.r(e);var i=n("f134"),r=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=r.a},ced5:function(t,e,n){"use strict";(function(t){n("c514");i(n("66fd"));var e=i(n("9299"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},d6d2:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var i={tuiTabs:function(){return n.e("components/thorui/tui-tabs/tui-tabs").then(n.bind(null,"34a5"))},tuiLoading:function(){return n.e("components/thorui/tui-loading/tui-loading").then(n.bind(null,"b45a"))},tuiListCell:function(){return n.e("components/thorui/tui-list-cell/tui-list-cell").then(n.bind(null,"057e"))},tuiCountdown:function(){return n.e("components/thorui/tui-countdown/tui-countdown").then(n.bind(null,"1218"))},tuiButton:function(){return n.e("components/thorui/tui-button/tui-button").then(n.bind(null,"009d"))},tuiNoData:function(){return n.e("components/thorui/tui-no-data/tui-no-data").then(n.bind(null,"5478"))},tuiModal:function(){return n.e("components/thorui/tui-modal/tui-modal").then(n.bind(null,"cd19"))},tuiLoadmore:function(){return n.e("components/thorui/tui-loadmore/tui-loadmore").then(n.bind(null,"5f80"))},tuiNomore:function(){return n.e("components/thorui/tui-nomore/tui-nomore").then(n.bind(null,"3a24"))}},r=function(){var t=this,e=t.$createElement,n=(t._self._c,t.loadding?null:t.__map(t.displayList,(function(e,n){var i=t.__get_orig(e),r="待支付"===e.status?t.getTime(e.create_time):null,o=t._f("getNum")(e.goodsList),u=e.netCost.toFixed(2).split("."),s=e.netCost.toFixed(2).split("."),a="交易成功"===e.status?t.isVisible(e.reviewState):null;return{$orig:i,m0:r,f0:o,g0:u,g1:s,m1:a}})));t.$mp.data=Object.assign({},{$root:{l0:n}})},o=[]},f134:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){n.e("components/views/t-order-item/t-order-item").then(function(){return resolve(n("3b84"))}.bind(null,n)).catch(n.oe)},r={components:{tOrderItem:i},data:function(){return{appid:"",tabs:[{name:"全部"},{name:"待付款"},{name:"待发货"},{name:"待收货"},{name:"待评价"}],loadding:!0,displayList:[],selectedOrder:null,selectedImg:"",currentTab:0,pageIndex:1,isShow:!1,isDelete:!1,loaddingMore:!1,pullUpOn:!0,scrollTop:0}},onLoad:function(t){this.appid=this.$store.state.appid,this.loadData(t)},computed:{orderList:function(){return this.$store.state.orderList}},filters:{getNum:function(t){var e=0;return t.forEach((function(t){e+=t.buyNum})),e}},watch:{currentTab:function(t){this.switchTab(t)},orderList:{deep:!0,handler:function(t){this.switchTab(this.currentTab)}}},methods:{getTime:function(t){t=t.replace(/-/g,"/");var e=864e5,n=Date.parse(new Date(t))+e,i=Date.parse(new Date);return(n-i)/1e3},loadData:function(e,n){var i=this,r="/getOrders/"+t.getStorageSync("pid");this.tui.request(r,"GET",void 0,!0).then((function(t){"0"===t.code&&(i.loadding=!1,i.currentTab=e.currentTab?parseInt(e.currentTab):0,i.$store.commit("setOrderList",t.orderList),n&&setTimeout((function(){wx.stopPullDownRefresh()}),300))}))},isVisible:function(t){return-1!==t.findIndex((function(t){return 1===t.count}))},change:function(t){this.currentTab=t.index},onCancel:function(){this.isShow=!1},onEnd:function(t){this.tui.toast("订单已失效"),this.cancelOrder(t)},switchTab:function(t){switch(t){case 0:this.displayList=this.orderList;break;case 1:this.displayList=this.orderList.filter((function(t){return"待支付"===t.status}));break;case 2:this.displayList=this.orderList.filter((function(t){return"待发货"===t.status}));break;case 3:this.displayList=this.orderList.filter((function(t){return"待收货"===t.status}));break;case 4:this.displayList=this.orderList.filter((function(t){return"待评价"===t.status}));break}},cancelOrder:function(t){var e=this,n="/closeOrder_miniProg/"+this.appid+"/"+t.orderNum;this.tui.request(n).then((function(n){if(204===n.code){var i=e.orderList.findIndex((function(e){return e.orderNum===t.orderNum}));e.orderList[i].status="交易关闭",e.tui.toast("取消成功，交易关闭")}else if(400===n.code){var r=e.orderList.findIndex((function(e){return e.orderNum===t.orderNum}));e.orderList[r].status="待评价",e.tui.toast("无法取消订单，该订单已支付成功")}else e.tui.toast(n.message)}))},pay:function(t){var e=this,n=n,i=t.paymentInfo;wx.requestPayment({appid:i.appid,nonceStr:i.nonceStr,package:i.package,timeStamp:i.timeStamp,signType:i.signType,paySign:i.paySign,success:function(){n="/updateOrder/"+t.orderNum+"/payment",e.tui.request(n,"PUT",{status:"待评价"}).then((function(){var n=t.goodsList;n.forEach((function(t){e.tui.request("/updateGoodsStock","PUT",{id:t.id,buyNum:t.buyNum})}))})),t.status="待评价",e.tui.href("/pages/order/success/success")},fail:function(t){console.log("err",t)}})},buy:function(t){var e=t.goodsList[0];this.tui.href("/pages/index/productDetail/productDetail?spu_id="+e.spu_id+"&sku_id="+e.id+"&buy=true")},remind:function(){this.tui.toast("待开发")},refund:function(t){this.tui.href("/pages/my/refundList/refundList?order="+encodeURIComponent(JSON.stringify(t)))},onReceipt:function(t){this.selectedOrder=t,this.selectedImg=t.goodsList[0].defaultImageUrl,this.isShow=!0},onConfirm:function(){this.addEvaluate(this.selectedOrder,"first"),this.selectedOrder=null,this.selectedImg=""},onDelete:function(t){this.selectedOrder=t,this.isDelete=!0},onRemove:function(t){var e=this;if(1===t.index){var n=this.orderList.findIndex((function(t){return t.orderNum===e.selectedOrder.orderNum}));this.orderList.splice(n,1);var i="/deleteOrder/"+this.selectedOrder.orderNum;this.tui.request(i,"DELETE").then((function(){e.tui.toast("删除订单成功")}))}this.isDelete=!1},invoiceDetail:function(){this.tui.href("/pages/my/invoiceDetail/invoiceDetail")},addEvaluate:function(e,n){var i=e.goodsList.length>1?"/pages/my/evaluateList/evaluateList?":"/pages/my/addEvaluate/addEvaluate?mode="+n+"&";i=i+"order="+encodeURIComponent(JSON.stringify(e)),t.navigateTo({url:i})},detail:function(t){this.tui.href("/pages/my/refundList/refundList?history="+encodeURIComponent(JSON.stringify(t)))}},onPullDownRefresh:function(){var t={currentTab:this.currentTab};this.loadData(t,!0)},onReachBottom:function(){var t=this;this.loaddingMore=!0,this.pullUpOn=!0,setTimeout((function(){t.loaddingMore=!1,t.pullUpOn=!1}),1e3)},onPageScroll:function(t){this.scrollTop=t.scrollTop}};e.default=r}).call(this,n("543d")["default"])}},[["ced5","common/runtime","common/vendor"]]]);